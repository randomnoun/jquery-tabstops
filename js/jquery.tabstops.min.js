/** tabstop jquery extensions
 * Site: the github site once that exists
 * Author: Greg Knox <knoxg+npm@randomnoun.com> */
!function(e){e.fn.extend({tabstops:function(t,a,s){return void 0===t?t="refresh":"object"==typeof t&&(a=t,t="refresh"),this.each(function(){new e.Tabstops(this,t,a,s)}),this}}),e.Tabstops=function(o,n,i,r){var l=e(o);if("refresh"==n)!function(a,o){var n=function(e,t){if("number"==typeof t)return t;var a=document.createElement("div");a.style.overflow="hidden",a.style.visibility="hidden",e.parentNode.appendChild(a),a.style.width=t;var s=a.offsetWidth;return e.parentNode.removeChild(a),s},i=a[0],r={};for(var l of["tabstops","default-tabstop","tab-element","tab-class","convert-tabs","leader-mode"]){var d=i.getAttribute("data-"+l);if(null!=d){var p=l.replace(/-([a-z])/g,function(e){return e[1].toUpperCase()});r[p]=d}}"data"==o&&(o=r);var f=e.extend({},e.Tabstops.defaults.refresh,r,a.data("tabstops"),o),b=f.tabstopsCssProperty,h=f.defaultTabstop,u=f.refreshOnResize,c=[],v=[];if(null==f.tabstops){var v=i.style.getPropertyValue(b)||getComputedStyle(i).getPropertyValue(b);v=v.trim().split(/,/)}else if(Array.isArray(f.tabstops))v=f.tabstops;else{if("string"!=typeof f.tabstops)throw"Unexpected options.tabstops; expected string or array, found "+typeof f.tabstops;v=f.tabstops.trim().split(/,/)}1==v.length&&""==v[0]&&(v=[]);for(var g=0;g<v.length;g++){var m=v[g];if("string"==typeof m){var y=m.trim().match(/[^\s"']+|"([^"]*)"|'([^']*)'/g),x=y[0],T=n(i,x),N={position:x,pos:T,align:"left"};if(y.length>1&&(N.align=y[1]),y.length>2&&(N.leader=y[2]),"dotted"==N.align||"dashed"==N.align||"solid"==N.align||"blank"==N.align){var d=N.align;N.align=N.leader,N.leader=d}N.align||(N.align="left"),N.leader||(N.leader="blank"),c.push(N)}else{if("object"!=typeof m)throw"Unexpected options.tabstops element; expected string or array";c.push(e.extend({},m,{pos:n(i,m.position)}))}}h=n(i,h);var C={tabstops:c,defaultTabstop:h,tabElement:f.tabElement,tabClass:f.tabClass,convertTabs:f.convertTabs,scale:f.scale,leaderMode:f.leaderMode};a.data("tabstops",C),s(a,C),u?t.observe(a[0]):t.unobserve(a[0])}(l,i);else if("option"==n)!function(t,a,s){if(void 0===a)return t.data("tabstops");if("string"==typeof a){if(void 0===s)return t.data("tabstops")?t.data("tabstops")[a]:null;t.data("tabstops")[a]=s}else if("object"==typeof a){var o=t.data("tabstops");o&&t.data("tabstops",e.extend(o,s))}}(l,i,r);else if("destroy"==n){var d=l.data("tabstops");d&&(a(l,d.tabElement,d.tabClass,!1,!0),l.data("tabstops",null))}},e.Tabstops.defaults={refresh:{tabElement:"span",tabClass:"tab",tabstopsCssProperty:"--tabstops",convertTabs:!0,tabstops:null,defaultTabstop:"96px",scale:1,leaderMode:"text",refreshOnResize:!0}};var t=new ResizeObserver(function(t){for(var a=0;a<t.length;a++){var o=e(t[a].target),n=o.data("tabstops");s(o,n)}});function a(t,a,s,o,n){e("svg[data-tabstops]",t).remove();var i=a+"."+s,r=e(i,t);if(r.css("display","inline"),r.css("width",""),r.css("minWidth",""),r.css("margin",""),r.css("borderBottom",""),r.css("textAlign",""),r.empty(),n&&r.each(function(e,t){if(t.tabstopsCreated){var a=t.previousSibling,s=t.nextSibling;a&&a.nodeType==Node.TEXT_NODE&&s&&s.nodeType==Node.TEXT_NODE?(s.nodeValue=a.nodeValue+"\t"+s.nodeValue,a.parentNode.removeChild(a)):a&&a.nodeType==Node.TEXT_NODE?a.nodeValue=a.nodeValue+"\t":s&&s.nodeType==Node.TEXT_NODE&&(s.nodeValue="\t"+s.nodeValue),t.parentNode.removeChild(t)}}),o){var l=!1;e(t).each(function(t,o){var n,i,r;e.each((n=!0,i=[],r=/\S/,function e(t){if(t.nodeType==Node.TEXT_NODE)(n||r.test(t.nodeValue))&&i.push(t);else for(var a=0,s=t.childNodes.length;a<s;++a)e(t.childNodes[a])}(o),i),function(e,t){for(var o=t.nodeValue,n=o.indexOf("\t");-1!=n;){l=!0;t.parentNode.insertBefore(document.createTextNode(o.substring(0,n)),t);var i=t.parentNode.insertBefore(document.createElement(a),t);i.setAttribute("class",s),i.tabstopsCreated=!0,t.nodeValue=o.substring(n+1),n=(o=t.nodeValue).indexOf("\t")}})}),l&&(r=e(i,t))}return r}function s(t,s){var o=t[0],n=s.tabstops,i=s.defaultTabstop,r=s.tabElement,l=s.tabClass,d=s.convertTabs,p=s.scale,f=s.leaderMode,b=e(o).offset(),h=b.left/p,u=e(o).width(),c=null,v=a(o,r,l,d,!1);function g(e,t){var a=document.createElementNS("http://www.w3.org/2000/svg",e);for(var s in t)a.setAttribute(s,t[s]);return a}r=r.toUpperCase(),e.each(s.tabstops,function(t,a){if("bar"==a.align){var s=(c=null==c?e(o).height():c)+parseInt(e(o).css("margin-bottom")),n=g("svg",{style:"position:absolute;",viewBox:"0 0 "+(a.pos+1)+" "+s,width:a.pos+1+"px",height:s+"px","data-tabstops":"bar"});n.appendChild(g("path",{d:"M"+a.pos+",0 v "+s,stroke:"#000"})),n.tabstopsCreated=!0,e(o).prepend(n).offset({top:b.top,left:b.left})}}),v.each(function(t,a){for(var s=e(a).offset().left/p-h,d=null,b=0;b<n.length;b++)if(n[b].pos>s&&"bar"!=n[b].align){d=n[b];break}if(!d){var c=(Math.floor(s/i)+1)*i;c<u&&(d={pos:c,align:"left"})}if(d){var g=d.align,m=d.leader,y=getComputedStyle(v[0].parentNode).textDecorationLine,x=getComputedStyle(v[0].parentNode).textDecorationStyle;getComputedStyle(v[0].parentNode).textDecorationColor;"underline"==y&&(m=x);var T=null;if("decimal"==g){e(a).css("display","inline-block"),void 0!==(T=function e(t){for(;null!=t;){if(t.nodeType==Node.TEXT_NODE){var a=t.nodeValue,s=a.indexOf(".");if(-1!=s){t.parentNode.insertBefore(document.createTextNode(a.substring(0,s)),t);var o=t.parentNode.insertBefore(document.createElement("SPAN"),t);return t.nodeValue=a.substring(s),o}}else if(t.nodeType==Node.ELEMENT_NODE){if(t.tagName==r&&t.classList.contains(l))return null;if(null!=t.firstChild){var n=e(t.firstChild);if(void 0!==n)return n}}t=t.nextSibling}}(a.nextSibling))&&null!=T||(g="right")}if("left"==g||"start"==g)spanTabWidth=d.pos-s;else if("right"==g||"end"==g){if(e(a).css("display","inline-block"),t+1<v.length){var N=v[t+1];textWidth=e(N).offset().left/p-h-s}else{(C=document.createElement("span")).style.overflow="hidden",C.style.visibility="hidden",o.appendChild(C),textWidth=e(C).offset().left/p-h-s,o.removeChild(C)}spanTabWidth=Math.max(0,d.pos-s-textWidth)}else if("center"==g){if(e(a).css("display","inline-block"),t+1<v.length){N=v[t+1];textWidth=e(N).offset().left/p-h-s}else{var C;(C=document.createElement("span")).style.overflow="hidden",C.style.visibility="hidden",o.appendChild(C),textWidth=e(C).offset().left/p-h-s,o.removeChild(C)}spanTabWidth=Math.max(0,d.pos-s-textWidth/2)}else if("decimal"==g){textWidth=e(T).offset().left/p-h-s;var E=T.previousSibling,W=E.nodeValue,V=T.nextSibling;T.parentNode.removeChild(E),T.parentNode.removeChild(T),V.nodeValue=W+V.nodeValue,spanTabWidth=Math.max(0,d.pos-s-textWidth)}if(e(a).css("display","inline-block"),"border"==f)("dotted"==m||"dashed"==m||"solid"==m)&&spanTabWidth>9?(e(a).css("borderBottom",m+" 1px"),e(a).css("margin","0px 4px"),e(a).css("width",spanTabWidth-8+"px")):e(a).css("width",spanTabWidth+"px");else{e(a).css("minWidth",spanTabWidth+"px"),spanTabWidth=e(a).width();var w="dotted"==m?".":"dashed"==m?"-":"solid"==m?"_":"blank"==m?" ":m&&m.startsWith('"')&&m.endsWith('"')?m.substring(1,m.length-1).replaceAll(" "," "):" ";w.length>1&&e(a).css("textAlign","right");var S=document.createTextNode(w),O=1;for(a.appendChild(S);e(a).width()<=spanTabWidth&&O<1e3;)S.nodeValue+=w,O+=1;S.nodeValue=S.nodeValue.substring(0,O*w.length-1)}}})}}($);